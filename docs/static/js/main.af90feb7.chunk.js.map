{"version":3,"sources":["components/LoadRunning/index.jsx","components/Empty/index.jsx","components/RefreshModule/index.jsx","components/LongList/index.jsx","assets/js/utils.js","LongList-demo.js","assets/js/localData.js","App.js","index.js"],"names":["Index","className","Empty","props","reload","onClick","loading","children","onRefresh","noMore","indicatorFinish","refreshRef","useRef","loadingRef","current","useEffect","onRefreshHandler","el","elRect","getBoundingClientRect","top","height","document","documentElement","clientHeight","getOffesetTop","window","addEventListener","removeEventListener","ref","rowClassName","LongList","useState","setNoMore","Row","getData","listRef","resp","setResp","setLoading","indexRef","firstIndex","lastIndex","domRef","container","containerOffsetTop","loadingDom","rowHeight","updateList","useCallback","getElementById","offsetTop","getElementsByClassName","querySelectorAll","offsetHeight","listLen","length","style","paddingTop","marginTop","slice","fetchData","a","res","console","log","Array","isArray","refresh","kzx","fetchMlist","timer","clearTimeout","setTimeout","cardList","list","t","bottom","se","isElView","scrollTop","body","firstItem","lastItem","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","target","id","parseInt","newFirstIndex","newLastIndex","observe","disconnect","position","indicatorDeactivate","map","item","index","key","cloneElement","LoadRunning","formatDate","d","fmt","o","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","getMilliseconds","k","test","replace","RegExp","$1","getFullYear","substr","getAppInfo","ua","navigator","userAgent","co","cookie","ur","cr","match","isApp","appKey","appVer","jumpUrl","url","location","href","auto","newUrl","scheme","indexOf","encodeURIComponent","insidebrowser","Row2","imgs","i","split","u","data-src","alt","Date","showtime","f","params","uid","deviceid","getCookie","defVal","value","localStorage","getItem","JSON","parse","err","error","getStorage","setItem","stringify","setStorage","v4","getMDeviceId","sign","c","n","getData2","Promise","resolve","reject","then","data","Error","LongListDemo","handleLazybeforeunveil","e","imgSrc","dataset","src","App","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.af90feb7.chunk.js","sourcesContent":["import React from 'react';\nimport './style.scss';\n\nfunction Index() {\n  return (\n    <div className=\"load-running\">\n      <i className=\"dynamic-running\"></i>加载中...\n    </div>\n  );\n}\n\nexport default Index;\n","import React from 'react';\nimport './style.scss';\n\nfunction Empty(props) {\n  const { reload } = props;\n  return (\n    <div className=\"emptyContainer\">\n      <p className=\"pic\"></p>\n      <p className=\"notice\">暂无数据</p>\n      <p className=\"tips\">出门在外，很快就回来…</p>\n      <button onClick={reload}>点击刷新</button>\n    </div>\n  );\n}\n\nexport default Empty;\n","import React, { useRef, useEffect } from 'react';\nimport './index.scss';\n\nconst Index = (props) => {\n  const {\n    loading,\n    children, onRefresh, noMore, indicatorFinish = '- 已加载全部 -',\n  } = props;\n  const refreshRef = useRef(null);\n\n  const loadingRef = useRef(loading)\n\n  loadingRef.current = loading\n\n  useEffect(() => {\n    const onRefreshHandler = () => {\n      if (getOffesetTop(refreshRef.current) && !loadingRef.current) {\n        onRefresh();\n      }\n    };\n\n    window.addEventListener('scroll', onRefreshHandler);\n    return () => {\n      window.removeEventListener('scroll', onRefreshHandler);\n    };\n  }, [onRefresh]);\n\n  \n  return (\n    <>\n      {children}\n      <div className=\"list-load-bootom\" ref={refreshRef}>\n        {!noMore ? (\n          <div className=\"athm-loading\">\n            <i className=\"athm-iconpng athm-iconpng-loadingblue\"></i>加载中...\n          </div>\n        ) : indicatorFinish}\n      </div>\n\n    </>\n  );\n};\n\nexport default Index;\n\nfunction getOffesetTop(el) {\n  const elRect = el.getBoundingClientRect();\n  // console.log(elRect.top, elRect.height, document.documentElement.clientHeight)\n  return (elRect.top + elRect.height - document.documentElement.clientHeight) < 100;\n}\n","import {useState, useEffect, useCallback, useRef, cloneElement} from 'react';\nimport LoadRunning from '../LoadRunning';\nimport Empty from '../Empty';\nimport RefreshModule from '../RefreshModule';\n\n/**\n * list 首元素低于 container.offsetTop, 或者尾元素高于可视区底部, 返回 true; 否则返回 false\n * @param {*} list 列表元素集合\n * @param {*} t container.offsetTop\n */\nfunction isElView(list, t) {\n  if(!list || !list.length){\n    return false\n  }\n  const top = list[0].getBoundingClientRect().top; // 元素顶端到可见区域顶端的距离\n  const bottom = list[list.length - 1].getBoundingClientRect().bottom; // 元素底部端到可见区域顶端的距离\n  const se = document.documentElement.clientHeight; // 浏览器可见区域高度。\n  // 头尾判断距离各增大 200 ，避免触底加载数据弹动过大误判为超出视窗，从而和 scroll 监听事件的 DOM 操作冲突\n  // 监听给 body.scrollTop 赋值之后，加载数据导致的 container.paddingTop 发生变化，从而导致元素的 offsetTop 和 body.scrollTop 不一致产生的白屏\n  if (top <= t + 200 && bottom >= se -36 -200) { // 36 是 loadingDom 的高度\n    return true;\n  }\n  return false;\n}\n\nconst rowClassName = 'list-row';\n\nconst LongList = (props) => {\n  const [noMore, setNoMore] = useState(false)\n  const {Row, getData, height='100vh'} = props\n  const listRef = useRef([])\n  const [resp, setResp] = useState(null)\n  const [loading, setLoading] = useState(false);\n  const indexRef = useRef({\n    firstIndex: 0,\n    lastIndex: 0,\n  })\n  const domRef = useRef({\n    container: null,\n    containerOffsetTop: 0,\n    loadingDom: null,\n    rowHeight: 0\n  })\n\n  // 更新渲染列表内容\n  const updateList = useCallback((firstIndex, lastIndex)=>{\n    if(!domRef.current.container){\n      domRef.current.container = document.getElementById('container')\n      domRef.current.containerOffsetTop = domRef.current.container.offsetTop\n    }\n    if(!domRef.current.loadingDom){\n      domRef.current.loadingDom = document.getElementsByClassName('list-load-bootom')[0]\n    }\n    if(!domRef.current.rowHeight){\n      domRef.current.rowHeight = document.querySelectorAll(`.${rowClassName}`)[0]?.offsetHeight || 0\n    }\n    const {container, loadingDom, rowHeight} = domRef.current\n    const listLen = listRef.current.length\n    // 设置当前列表首尾索引\n    indexRef.current = {\n      firstIndex,\n      lastIndex,\n    }\n    // 设置容器 padding-top\n    container.style.paddingTop = `${firstIndex * rowHeight}px`\n    // 设置加载中 DOM 的 margin-top\n    if(loadingDom){\n      loadingDom.style.marginTop = `${(listLen - lastIndex) * rowHeight}px`\n    }\n    // 渲染新 resp\n    setResp(listRef.current.slice(firstIndex, lastIndex))\n  },[])\n\n  // 获取数据\n  const fetchData = useCallback(async ()=>{\n    let res = []\n    try {\n      res = await getData()\n    } catch (error) {\n      console.log(error)\n    }\n    if(Array.isArray(res)){\n      // 返回数据为空，则设置已加载全部\n      if(res.length <= 0){\n        setNoMore(true)\n      }\n      listRef.current = [...listRef.current, ...res]\n    }\n    let {firstIndex, lastIndex} = indexRef.current\n    const listLen = listRef.current.length\n    lastIndex = lastIndex + 10 > listLen ? listLen : lastIndex + 10\n    firstIndex = lastIndex - 20 > 0 ? lastIndex - 20 : 0\n    \n    updateList(firstIndex, lastIndex)\n  }, [getData, updateList])\n\n  // 加载更多\n  const reload = useCallback(async ()=>{\n    try {\n      setLoading(true)\n      await fetchData()\n    } catch (error) {\n      console.log('catch loading false')\n      setLoading(false)\n    }\n  }, [fetchData])\n\n  // 无数据时，点击刷新\n  const refresh = useCallback(()=>{\n    setResp(null)\n    if(window.kzx && typeof window.kzx.fetchMlist === 'function'){\n      fetchData()\n    }else{\n      setResp([])\n    }\n  }, [fetchData])\n\n  // 防止滚动太快，内容区域脱离可视区，没有机会触发 updateList \n  useEffect(()=>{\n    let timer = null\n    window.addEventListener('scroll', ()=>{\n      if(timer ){\n        clearTimeout(timer)\n        timer = null\n      }\n      timer = setTimeout(() => {\n        const cardList = document.querySelectorAll(`.${rowClassName}`)\n        // 如果可视区至少一部分为空白，则将卡片定位到第 5 个\n        if(!isElView(cardList, domRef.current.containerOffsetTop)){\n          if(cardList[5]){\n            console.log('offsetTop', document.getElementsByClassName('list-row')[5].offsetTop)\n            console.log('paddingTop', document.getElementById('container').style.paddingTop)\n            document.documentElement.scrollTop = document.body.scrollTop = cardList[5].offsetTop\n            console.log('scrollTop', document.body.scrollTop)\n          }\n        }\n      }, 200);\n    })\n  }, [])\n\n  useEffect(()=>{\n    let firstItem = null\n    let lastItem = null\n\n    // 创建监听对象\n    const observer = new IntersectionObserver((entries) => {\n      entries.forEach((entry) => {\n        // 如果元素进入可视区\n        if(entry.isIntersecting){\n          const { firstIndex } = indexRef.current\n          const listLen = listRef.current.length\n\n          if(entry.target.id === firstItem.id && parseInt(firstItem.id) > 0) {\n            // 当第一个元素进入视窗\n            const newFirstIndex = firstIndex - 10 > 0 ? firstIndex - 10 : 0;\n            const newLastIndex = newFirstIndex + 20 >= listLen ? listLen : newFirstIndex + 20;\n            updateList(newFirstIndex, newLastIndex)\n          }else if (entry.target.id === lastItem.id && parseInt(lastItem.id) < listRef.current.length - 1){\n            // 当展示的最后一个元素，而非真正的最后一个元素进入视窗\n            const newFirstIndex = firstIndex + 10;\n            const newLastIndex = newFirstIndex + 20 >= listLen ? listLen : newFirstIndex + 20;\n            if(newFirstIndex < newLastIndex){\n              updateList(newFirstIndex, newLastIndex)\n            }\n          }\n        }\n      });\n    });\n\n    // 每当渲染列表发生改变，重新将首尾元素添加进观察列表\n    const cardList = document.querySelectorAll(`.${rowClassName}`);\n    if(cardList.length > 0){\n      firstItem = cardList[0]\n      lastItem = cardList[cardList.length - 1]\n      observer.observe(firstItem)\n      observer.observe(lastItem)\n    }\n\n    // 本次渲染完毕，设置 loading 为 false, 即允许重新触发加载\n    setLoading(false)\n\n    // 本次渲染卸载前，断开观察\n    return ()=>{\n      observer.disconnect()\n    }\n  }, [resp])\n\n  // 页面初始加载数据\n  useEffect(()=>{\n    refresh()\n  }, [refresh])\n\n  return (\n    <div id=\"container\" style={{position:'relative', height: height}}>\n      {\n        !resp ? <LoadRunning/> : (\n          resp.length === 0 ? <Empty reload={refresh}/>:(\n            <RefreshModule\n            loading={loading}\n            onRefresh={reload}\n            noMore={noMore}\n            indicatorDeactivate={'加载中…'}>\n              {\n                resp.map((item, index)=>{\n                  const key = indexRef.current.firstIndex + index\n                  const id = key\n                  return (\n                    cloneElement(Row(item), {\n                      className: rowClassName,\n                      key,\n                      id\n                    })\n                  )\n                })\n              }\n            </RefreshModule>\n          )\n        )\n      }\n    </div>\n  );\n};\n\nexport default LongList;","import { getCookie } from '@auto/js-cookie';\n// import uuidv4 from 'uuid/v4';\nimport { v4 } from 'uuid';\nimport { getStorage, setStorage } from './localData';\n/**\n * 格式化日期\n * 使用示例：formatDate(new Date(), 'yyyy-MM-dd')\n * @param {*} d \n * @param {*} fmt \n */\nfunction formatDate(d, fmt){\n  var o = { \n    \"M+\" : d.getMonth()+1,                 //月份 \n    \"d+\" : d.getDate(),                    //日 \n    \"h+\" : d.getHours(),                   //小时 \n    \"m+\" : d.getMinutes(),                 //分 \n    \"s+\" : d.getSeconds(),                 //秒 \n    \"q+\" : Math.floor((d.getMonth()+3)/3), //季度 \n    \"S\"  : d.getMilliseconds()             //毫秒 \n  }; \n  if(/(y+)/.test(fmt)) {\n    fmt=fmt.replace(RegExp.$1, (d.getFullYear()+\"\").substr(4 - RegExp.$1.length)); \n  }\n  for(var k in o) {\n    if(new RegExp(\"(\"+ k +\")\").test(fmt)){\n      fmt = fmt.replace(RegExp.$1, (RegExp.$1.length===1) ? (o[k]) : ((\"00\"+ o[k]).substr((\"\"+ o[k]).length)));\n    }\n  }\n  return fmt; \n}\n\n/**\n * 判断是否在 App 内\n */\nfunction getAppInfo() {\n  const ua = navigator.userAgent;\n  const co = document.cookie;\n  const ur = /auto_(iphone|android)(;|%3B|\\/)(\\d+\\.\\d+\\.\\d+)/i;\n  const cr = /.*app_key=auto_(iphone|android)(.*)app_ver=(\\d+\\.\\d+\\.\\d+)/i;\n  const match = ua.match(ur) || co.match(cr);\n\n  return {\n    isApp: /autohomeapp/.test(ua) || ur.test(ua) || cr.test(co),\n    appKey: match && match[1],\n    appVer: match && match[3],\n  };\n}\n\n/**\n * 如果在 App 内，则给 url 添加协议头；如果是 M 端，则不添加\n * @param {*} url \n * @param {*} auto \n */\nfunction insidebrowser(url, auto = true) {\n  if (!url) { return ''; }\n\n  // App 协议不支持 url 中带有空格\n  const newUrl = url.replace(/\\s/g, '');\n  const scheme = 'autohome://';\n\n  // url 也许是一个 scheme 地址\n  if (newUrl.indexOf(scheme) !== -1) {\n    return newUrl;\n  }\n\n  if (!getAppInfo().appKey) {\n    if (!auto) { return url; }\n    return newUrl.replace(/https?:/, '');\n  }\n\n  return `${scheme}insidebrowserwk?url=${encodeURIComponent(newUrl)}`;\n}\n\n/**\n * 跳转 url，如果是 App 内会自动添加协议头\n * @param {*} url \n */\nfunction jumpUrl(url){\n  window.location.href = insidebrowser(url)\n  // window.location.href = url\n}\n\n/**\n * 获取登录状态 & 用户昵称\n */\nfunction getMUserInfo() {\n  // let loggedIn = false; // 是否登录\n  let uid = 0; // 用户ID\n\n  const cookieClubUserShow = getCookie('clubUserShow');\n  // const autouserid = getCookie('autouserid');\n  // const cookieClubUserShow = '52100122|197|2|%e7%9a%b1%e7%9c%89_|0|0|0|/g11/M04/AB/BA/120X120_0_q87_autohomecar__wKjBzFnkZg6ABBS_AAFIXhsHM1c188.jpg|2018-07-31 19:42:33|0'\n  \n  // if (cookieClubUserShow || autouserid) {\n  if (cookieClubUserShow) {\n    const clubUserShow = cookieClubUserShow.split('|');\n    // loggedIn = true;\n    [uid] = clubUserShow;\n  }\n  return {\n    // loggedIn,\n    uid,\n  };\n}\n\n// 获取 m 端设备 id\nfunction getMDeviceId() {\n  let deviceid = getCookie('__CAR_MALL_UUID__') || getStorage('__CAR_MALL_UUID__', '');\n\n  if (deviceid === '') {\n    deviceid = v4();\n    setStorage('__CAR_MALL_UUID__', deviceid);\n  }\n\n  return deviceid;\n}\n\nexport {\n  formatDate,\n  getAppInfo,\n  insidebrowser,\n  jumpUrl,\n  getMUserInfo,\n  getMDeviceId\n}","import React, {useEffect} from 'react';\nimport LongList from './components/LongList';\n// 测试 2 使用\nimport { formatDate, jumpUrl, getMDeviceId } from './assets/js/utils'\nimport './assets/scss/longlist-demo.css'\n\n/** 测试 1 开始*/\n// 列表行内容模板\nconst Row1 = (item)=>(\n  <div className='athm-card' style={{height:204,lineHeight:'104px',textAlign:'center',color:'red', width:'100%',boxSizing:'border-box',border:'solid red 1px'}} >\n    {item}\n  </div>\n)\nconst dataList = []\n// 加载数据\nfunction getData1(){\n  return new Promise((resolve, reject)=>{\n    setTimeout(() => {\n      for(let i=0;i<10;i++){\n        dataList.push(dataList.length)\n      }\n      resolve(dataList.slice(-10))\n    }, 200);\n  })\n}\n/** 测试 1 结束*/\n\n/** 测试 2 开始*/\n//列表行内容模板\nconst Row2 = (item)=>{\n  const imgs = item.i.split('|')\n    return imgs.length >= 3? (\n      <div className='athm-card'>\n        <a className=\"athm-card-album43\" onClick={()=>{jumpUrl(item.u)}}>\n          <div className=\"athm-card-album43__caption\">{item.t}</div>\n          <div className=\"athm-card-album43__album\">\n            <div className=\"athm-card-album43__assist\"><img className=\"lazyload\" data-src={imgs[0]} alt=\"\" /></div>\n            <div className=\"athm-card-album43__assist\"><img className=\"lazyload\" data-src={imgs[1]} alt=\"\" /></div>\n            <div className=\"athm-card-album43__assist\"><img className=\"lazyload\" data-src={imgs[2]} alt=\"\"/></div>\n          </div>\n          <div className=\"athm-card-unit-information\">\n          <div className=\"athm-card-unit-information__item athm-card-unit-information__item--right\">{formatDate(new Date(item.showtime*1000), \"M-d\")}</div>\n            <div className=\"athm-card-unit-information__assist\">\n              {/* <span className=\"athm-card-unit-information__item\">{item.cmt_num}评论</span><i className=\"athm-card-unit-information__division\">/</i> */}\n              <span className=\"athm-card-unit-information__item\">{item.f}</span>\n            </div>\n          </div>\n        </a>\n      </div>\n    ) : (imgs.length >= 1?(\n      <div className='athm-card'>\n        <a className=\"athm-card-thumb43 athm-card-thumb43__threerows\" onClick={()=>{jumpUrl(item.u)}}>\n          <div className=\"athm-card-thumb43__assist\">\n            <img className=\"lazyload\" data-src={imgs[0]} alt=\"\" />\n          </div>\n          <div className=\"athm-card-thumb43__caption\">{item.t}</div>\n          <div className=\"athm-card-unit-information\">\n            <div className=\"athm-card-unit-information__item athm-card-unit-information__item--right\">{formatDate(new Date(item.showtime*1000), \"M-d\")}</div>\n            <div className=\"athm-card-unit-information__assist\">\n              {/* <span className=\"athm-card-unit-information__item\">{item.cmt_num}评论</span><i className=\"athm-card-unit-information__division\">/</i> */}\n              <span className=\"athm-card-unit-information__item\">{item.f}</span>\n            </div>\n          </div>\n        </a>\n      </div>\n    ) : null)\n}\n\nconst uid = getMDeviceId()\nconst params = {uid, sign: 'ex_d5500b6f', c: 'othercars', n: 10}\n// 加载数据\nconst getData2 = ()=>{\n  return new Promise((resolve, reject)=>{\n    window.kzx.fetchMlist(params).then((data)=>{\n      resolve(data)\n    })\n    // 3 秒超时\n    setTimeout(() => {\n      reject(new Error('time is out'))\n    }, 3000);\n  })\n}\n/** 测试 2 结束*/\nconst LongListDemo = () => {\n  // useEffect(()=>{\n  //   const stickyDom = document.getElementById('sticky')\n  //   window.addEventListener('scroll', ()=>{\n  //     const scrollTop = document.documentElement.scrollTop || document.body.scrollTop\n  //     if(scrollTop > 200){\n  //       stickyDom.classList.add('fixed')\n  //     }else{\n  //       stickyDom.classList.remove('fixed')\n  //     }\n  //   })\n  // }, [])\n  return (\n    <div>\n      <div className={\"header\"}>header</div>\n      {/* <div id=\"sticky\" className={\"sticky\"}>sticky</div> */}\n      {/* \n        列表最多同时展示 20 条，一次加载 10 条， getData 可一次返回任意条数据 \n        height 指 LongList 组件在初始视窗中的占比， 默认 100vh，主要为了控制 Running 组件的位置\n      */}\n      {/* <LongList Row={Row} getData={getData} height={'100vh'}/> */}\n      {/* <LongList Row={Row1} getData={getData1} height={'60vh'}/> */}\n      <LongList Row={Row2} getData={getData2} height={'60vh'}/>\n    </div>\n    \n  );\n};\n\nexport default LongListDemo;","/**\n * 将数据存入 Web Storage\n *\n * @param {string} key 作为 Storage 的 Key\n * @param {Object} value 传入的数据\n */\nexport function setStorage(key, value) {\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n  } catch (err) {\n    console.error(err);\n  }\n}\n\n/**\n * 从 Web Storage 获取数据\n *\n * @param {string} key 作为 Storage 的 Key\n * @returns {Object} 与 key 对应的数据\n */\nexport function getStorage(key, defVal) {\n  try {\n    const value = localStorage.getItem(key);\n    if (value === null || value === '') {\n      return defVal;\n    }\n    return JSON.parse(value);\n  } catch (err) {\n    console.error(err);\n    return defVal;\n  }\n}\n","import {useEffect} from 'react';\nimport 'lazysizes';\n// import KuaiZX from './KuaiZX.js';\n// import KuaiZX from './KuaiZX-demo.js';\nimport LongListDemo from './LongList-demo.js';\n// import Virtualization from './Virtualization.js';\n// import ReactWindow from './ReactWindow';\nimport './assets/scss/athm.scss';\n\nfunction handleLazybeforeunveil(e) {\n  // 过滤 http(s)\n  const el = e.target;\n  const imgSrc = el.dataset.src && el.dataset.src.replace(/^https?:/, '');\n  el.dataset.src = imgSrc;\n}\n\nfunction App(){\n  useEffect(() => {\n    document.addEventListener('lazybeforeunveil', handleLazybeforeunveil);\n    return () => {\n      document.removeEventListener('lazybeforeunveil', handleLazybeforeunveil);\n    };\n  }, []);\n\n  return (\n    <LongListDemo />\n  )\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}